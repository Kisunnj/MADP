# ИПР2: Знакомство с Blazor и SignalR

## Выполненные задания

### Задание 1: Взаимодействие страницы Blazor с API

✅ **Создан Blazor Web Application проект** (`WEB_253551_Levchuk.BlazorUI`):
- Использован .NET 8.0
- Интерактивный серверный режим (Interactive Server)
- Добавлен в solution

#### 1.1. Компоненты Blazor

✅ **CategorySelector** - компонент выбора категории:
- Выпадающий список категорий
- Двустороннее связывание данных с `@bind`
- EventCallback для уведомления родителя об изменении

✅ **Pager** - компонент пагинации:
- Кнопки "Предыдущая" и "Следующая"
- Отображение номеров страниц
- Активная страница выделяется
- Отключение кнопок на первой/последней странице

✅ **ProductList** - компонент списка блюд:
- Отображение карточек блюд
- Изображения с fallback
- Ссылка на детальную информацию

✅ **ProductDetails** - страница деталей блюда:
- Маршрут `/dish/{id:int}`
- Загрузка данных с API
- Индикатор загрузки
- Обработка ошибок
- Кнопка возврата к каталогу

#### 1.2. Сервис DataService

✅ **Реализован сервис для работы с API**:
- Интерфейс `IDataService`
- HTTP клиент с настроенным BaseAddress
- Методы для получения категорий, списка блюд и деталей
- JSON сериализация с camelCase
- Обработка ошибок

#### 1.3. Страница Catalog

✅ **Главная страница каталога** (`/catalog`):
- Использует все компоненты (CategorySelector, ProductList, Pager)
- Фильтрация по категориям
- Пагинация (3 блюда на странице)
- Обновление данных при смене фильтра/страницы
- `StateHasChanged()` для обновления компонентов

Файлы:
- `WEB_253551_Levchuk.BlazorUI/Components/CategorySelector.razor`
- `WEB_253551_Levchuk.BlazorUI/Components/Pager.razor`
- `WEB_253551_Levchuk.BlazorUI/Components/ProductList.razor`
- `WEB_253551_Levchuk.BlazorUI/Components/Pages/ProductDetails.razor`
- `WEB_253551_Levchuk.BlazorUI/Components/Pages/Catalog.razor`
- `WEB_253551_Levchuk.BlazorUI/Services/DataService.cs`

### Задание 2: Интерактивное приложение Blazor реального времени

✅ **Создана игра "Чак-а-лак" (Chuck-a-Luck)** - игра в кости:

#### 2.1. SignalR Hub

✅ **GameHub** - серверная часть игры:
- Управление комнатами (до 2 игроков в комнате)
- Обработка ставок
- Генерация случайных результатов (3 кости)
- Подсчет выигрыша:
  - 1 совпадение: ставка x2
  - 2 совпадения: ставка x3
  - 3 совпадения: ставка x10
- Обработка подключения/отключения игроков
- Группы для изоляции комнат

#### 2.2. Модели игры

✅ **Созданы модели**:
- `GameRoom` - состояние игровой комнаты
- `Player` - информация об игроке (имя, баланс, connectionId)
- `GameState` - состояния игры (Waiting, Betting, Rolling, Finished)

#### 2.3. Blazor WebAssembly клиент

✅ **Страница /game** - клиентская часть:
- Подключение к SignalR Hub
- Форма присоединения к комнате
- Выбор числа для ставки (1-6)
- Размер ставки
- Отображение результатов броска костей
- Лог событий игры
- Real-time обновления через SignalR:
  - Присоединение/выход игроков
  - Размещение ставок
  - Результаты броска
  - Подсчет выигрыша

#### 2.4. Реализованный функционал

✅ **Бизнес-логика на сервере**:
- Проверка баланса перед ставкой
- Лимит игроков в комнате
- Автоматическое удаление пустых комнат
- Асинхронная обработка

✅ **Клиент**:
- Interactive Server режим
- Двустороннее взаимодействие с SignalR
- Красивый UI с Bootstrap
- Стилизованные кости
- Responsive дизайн

Файлы:
- `WEB_253551_Levchuk.BlazorUI/Hubs/GameHub.cs`
- `WEB_253551_Levchuk.BlazorUI/Models/Game/GameRoom.cs`
- `WEB_253551_Levchuk.BlazorUI/Components/Pages/Game.razor`

## Запуск приложения

### Blazor UI проект:
```bash
cd WEB_253551_Levchuk.BlazorUI
dotnet run
```
Доступно по адресам:
- HTTPS: https://localhost:5001 (или другой порт)
- HTTP: http://localhost:5000

### API проект (для работы каталога):
```bash
cd WEB_253551_Levchuk.API
dotnet run
```
API доступен по адресу: https://localhost:7001

## Тестирование

### Тестирование каталога:
1. Запустите API проект
2. Запустите Blazor UI проект
3. Откройте https://localhost:5001/catalog
4. Выберите категорию из списка
5. Переключайте страницы с помощью пагинации
6. Кликните на "Подробнее" для просмотра деталей блюда

### Тестирование игры:
1. Откройте https://localhost:5001/game
2. Введите имя игрока и ID комнаты
3. Нажмите "Присоединиться"
4. Выберите число от 1 до 6
5. Введите размер ставки
6. Нажмите "Сделать ставку"
7. Посмотрите результат броска костей
8. Проверьте изменение баланса

Для тестирования многопользовательской игры:
1. Откройте игру в двух разных вкладках/браузерах
2. Присоединитесь к одной комнате с разными именами
3. Делайте ставки поочередно
4. Наблюдайте за логом событий в real-time

## Структура проекта

```
WEB_253551_Levchuk.BlazorUI/
├── Components/
│   ├── CategorySelector.razor         # Компонент выбора категории
│   ├── Pager.razor                     # Компонент пагинации
│   ├── ProductList.razor               # Компонент списка блюд
│   └── Pages/
│       ├── Catalog.razor               # Страница каталога
│       ├── ProductDetails.razor        # Страница деталей блюда
│       └── Game.razor                  # Страница игры
├── Hubs/
│   └── GameHub.cs                      # SignalR Hub для игры
├── Models/
│   ├── Category.cs                     # Модель категории
│   ├── Dish.cs                         # Модель блюда
│   ├── ResponseData.cs                 # Обертка для ответов API
│   ├── ListModel.cs                    # Модель для пагинации
│   └── Game/
│       └── GameRoom.cs                 # Модели игры
├── Services/
│   ├── IDataService.cs                 # Интерфейс сервиса
│   └── DataService.cs                  # Реализация сервиса для API
└── Program.cs                          # Настройка приложения
```

## Зависимости

- Microsoft.AspNetCore.SignalR.Client (8.0.0)
- Bootstrap 5 (для UI)

## Технологии

- **Blazor Server** - Interactive Server режим
- **SignalR** - Real-time коммуникация
- **Bootstrap 5** - Стилизация
- **HttpClient** - Интеграция с API
- **Dependency Injection** - Для сервисов

## Примечания

- Blazor UI работает на отдельном порту от основного приложения
- API должен быть запущен для работы каталога
- Игра работает полностью автономно через SignalR
- Данные игры хранятся в памяти сервера (не персистентно)
- При перезапуске сервера все игровые комнаты сбрасываются

